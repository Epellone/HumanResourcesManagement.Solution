@using HumanResourcesManagementAPI.Models
@inject HttpClient HttpClient
@inject Microsoft.AspNetCore.Components.NavigationManager NavigationManager



<h3>AnagraficaCandidato</h3>
@page "/AnagraficaCandidato"


<style>
    table {
        border-collapse: collapse;
        width: 100%;
    }

    th, td {
        padding: 8px;
        text-align: left;
        border-bottom: 1px solid #ddd;
    }
</style>


<button type="button" @onclick="MostraFormAggiunta">Aggiungi Candidato</button>
@if (mostraFormAggiunta)
{
    <form @onsubmit="AggiungiCandidato">
        <input type="text" @bind="nuovoCandidato.Nome" placeholder="Nome" />
        <input type="text" @bind="nuovoCandidato.Cognome" placeholder="Cognome" />
        <input type="text" @bind="nuovoCandidato.RecapitoTelefonico" placeholder="Recapito Telefonico" />
        <input type="text" @bind="nuovoCandidato.CF" placeholder="Codice Fiscale" />
        <input type="text" @bind="nuovoCandidato.Email" placeholder="Email" />
        <input type="text" @bind="nuovoCandidato.Comune" placeholder="Comune" />
        <input type="text" @bind="nuovoCandidato.Provincia" placeholder="Provincia" />
        <input type="text" @bind="nuovoCandidato.DataDiNascita" placeholder="Data Di Nascita" />

        <button type="submit">Salva</button>
    </form>
}

<table>
    <tr>
        <th>Nome</th>
        <th>Cognome</th>
        <th>Recapito Telefonico</th>
        <th>CF</th>
        <th>Indirizzo e-mail</th>
        <th>Comune</th>
        <th>Provincia</th>
        <th>Data di nascita</th>

    </tr>

    @foreach (var candidato in listaCandidati)
    {
        <tr>
            <td>@candidato.Nome</td>
            <td>@candidato.Cognome</td>
            <td>@candidato.RecapitoTelefonico</td>
            <td>@candidato.CF</td>
            <td>@candidato.Email</td>
            <td>@candidato.Comune</td>
            <td>@candidato.Provincia</td>
            <td>@candidato.DataDiNascita</td>

        </tr>

    }

</table>




@code {
    private bool mostraFormAggiunta = false;
    private Candidato nuovoCandidato = new Candidato();
    private List<Candidato> listaCandidati;


    private void MostraFormAggiunta()
    {
        mostraFormAggiunta = true;
    }

    protected override async Task OnInitializedAsync()
    {

        await GetAll();
    }

    private async Task GetAll()
    {
        try
        {
            listaCandidati = await HttpClient.GetFromJsonAsync<List<Candidato>>("api/Candidato");
        }
        catch (HttpRequestException)
        {
            return;
        }

    }
    private async Task AggiungiCandidato()
    {
        var response = await HttpClient.PostAsJsonAsync("api/Candidato", nuovoCandidato);

        if (response.IsSuccessStatusCode)
        {
            var candidatoCreato = await response.Content.ReadFromJsonAsync<Candidato>();
            listaCandidati.Add(candidatoCreato); 

            nuovoCandidato = new Candidato();
            mostraFormAggiunta = false;

            NavigationManager.NavigateTo("/AnagraficaCandidato");
        }
        else
        {

            Console.WriteLine("Errore durante l'aggiunta del candidato.");
        }
    }
}
